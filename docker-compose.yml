version: '3.8'

x-common-variables: &common-variables
   - LEAFLET_VOLUME_PATH=//d/tests/leaflet_data


   
services:
  leafletalarms:
    image: ${DOCKER_REGISTRY-}leafletalarms
    depends_on:
     - mongoservice
    build:
      context: .
      dockerfile: LeafletAlarms/Dockerfile
    volumes:
      - ${LEAFLET_VOLUME_PATH}/osm_data:/osm_data

  routermicroservice:
    image: ${DOCKER_REGISTRY-}routermicroservice
    depends_on:
     - mongoservice
    build:
      context: .
      dockerfile: RouterMicroService/Dockerfile
    volumes:
     - ${LEAFLET_VOLUME_PATH}/osm_data:/osm_data
      

  mongoservice:
    image : mongo
    container_name: mongodb
    restart: always
    volumes: 
      - //d/tests/leaflet_data/mongo_data/:/data/db
      #- ${LEAFLET_VOLUME_PATH}/mongo_data:/data/db
    ports:
     - "27018:27017"
    expose:
     - "27017"

  redisservice:
    image: redis
    environment:
      - ALLOW_EMPTY_PASSWORD=yes

# START keycloack
  #postgres:
  #  image: postgres
  #  volumes:
  #    - leaflet_data:/postgres/var/lib/postgresql/data
  #  environment:
  #    POSTGRES_DB: keycl0ak
  #    POSTGRES_USER: keycl0ak
  #    POSTGRES_PASSWORD: password
  #  ports:
  #    - 5431:5431

  #keycloak:
  #  build:
  #    context: services/keycloak
  #  volumes:
  #    - leaflet_data:/keycloak/opt/jboss/keycloak/imports
  #  environment:
  #    DB_VENDOR: POSTGRES
  #    DB_ADDR: postgres
  #    DB_DATABASE: keycl0ak
  #    DB_USER: keycl0ak
  #    DB_PASSWORD: password
  #    KEYCLOAK_USER: administrat0r
  #    KEYCLOAK_PASSWORD: asc88a8c0ssssqs
  #    KEYCLOAK_IMPORT: /opt/jboss/keycloak/imports/realm-export.json -Dkeycloak.profile.feature.upload_scripts=enabled
  #  ports:
  #    - 8080:8080
  #  depends_on:
  #    - postgres

# END keycloak

